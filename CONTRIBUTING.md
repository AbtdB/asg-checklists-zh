# 如何参与翻译

## 环境搭建

需要的软件如下：

- ASG
  - 显然。
- Python ≥ 3.9
  - Pillow ≥ 9.5.0
    - 用于格式检查。
- JDK ≥ 11
  - 以下工具均使用 Java 开发。
- [OmegaT](http://omegat.org/) ≥ 6.0.0
  - 计算机辅助翻译（CAT）软件。
- [Tikal](https://okapiframework.org/wiki/index.php/Tikal)
  - 下载 `okapi-apps_xxx.zip`，解压其内容到本项目 `okapi_bin` 下备用。
  - Okapi 框架提供的工具，用于导出、合并 XLIFF 文件。Okapi 是一套用于本地化和翻译工作的开源组件和工具集。

开始前，还需要设置环境变量 `ASG_HOME=<你的 ASG 所在路径>`，以便脚本访问检查单文件。

## 工作流

### 概述

原始检查单文件包含大量与翻译无关的内容，因此，我们首先使用过滤器提取源文件中需要翻译的文本，保存为原文-译文对形式的『翻译单元』。XLIFF 是一种基于 XML 储存翻译单元的文件格式。然后，我们可以不受干扰地翻译 XLIFF，最后将其合并回源文件，得到译文文件。

版本控制方面，建议遵循 [Github Flow](https://docs.github.com/zh/get-started/quickstart/github-flow)。本项目中不包含检查单原文、译文和中间的 XLIFF 文件，纳入版本控制的只有 OmegaT 项目翻译记忆 `project_save.tmx`。

### 提取 XLIFF

确认你已经设置好了 Java、Tikal 和 `ASG_HOME`，然后运行项目根目录下的 `extractxlf.cmd`，它将自动从 `%ASG_HOME%\Data` 读取英文检查单文件，调用 Tikal，应用 `okf_xml@asgChecklists` 过滤器生成 XLIFF，并输出到 `omegat/source` 下供 OmegaT 翻译。

### 翻译

启动 OmegaT，单击 `项目 > 打开...` 打开项目根目录下的 `omegat` 文件夹，开始翻译之前生成的 XLIFF 文件。

- 建议在 `选项 > 首选项 > 保存和输出` 中勾选 `允许局部后处理命令`，这样在创建译文文档时会自动调用本项目的后处理脚本，执行格式检查、构建译文、部署等工作。
- 建议在 `选项 > 首选项 > 团队` 中将 `姓名或 ID` 设为与 Git 用户名相同的名称。该名称会被记录到翻译记忆库中。
- 在 `注释` 窗格可以查看过滤器根据片段来源添加的类型注释，如 `Text`、`Note`、`Audio Challenge`、`Check Action` 等，有助于你区分翻译的是检查项目的哪个部分。

具体请参阅 OmegaT 的用户手册（`帮助 > 用户指南...`）。

### 构建译文文件

翻译完成后，在 OmegaT 中单击 `项目 > 创建译文文件`。OmegaT 会先在 `omegat/target` 目录下生成存有译文的 XLIFF 文件，然后（如果勾选了 `允许局部后处理命令`）自动调用后处理脚本 `build.cmd`。

`build.cmd` 会先调用 `lint\lint.py` 执行格式检查，然后调用 Tikal 构建译文文件，输出至 `release` 文件夹，并部署至 `%ASG_HOME%\Data` 供测试。

## 翻译规则

### `Note` 文本的排版

ASG 检查单比较蛋疼的一点是，它的项目注释（`Note` 元素）内的文本不支持自动换行，而是将 `|` 作为换行符使用。幸运的是，本项目提供了游标卡尺的替代品 `lint.py`，后处理脚本 `build.cmd` 会调用它，在构建译文文件前为项目注释自动添加 `|`，确保每行长度不会超标。

`lint.py` 会避免让不合适的标点符号出现在行首，但它没有分词能力，折行时不会避开单词或公式。因此，建议为英文或工程符号占比较大的译文手动添加 `|` 来折行，`lint.py` 会检测已有的 `|`，在长度不超标的情况下不会添加不必要的换行。

细节：

- 注释文本使用的字体是 Calibri，后备字体是 Segoe UI Symbol 和微软雅黑。`lint` 目录中附带了一份合并了这三个字体的 ttf，供脚本计算宽度。
- 假定字号为 10，则单行文本长度上限约为 219.3，可以容纳 21 个汉字或 43 个数字。
- `lint.py` 会在 `lint.log` 中记录所作修改。

### 术语

1. 对于航空类术语，优先参考民航机型的 FCOM、FCTM 等手册的翻译，空客优先。其他术语参考 [术语在线](https://www.termonline.cn/) 网站的数据库。优先参考航空航天类，其次是航海、电力等其他学科。
2. 对于存在现有翻译但是中文词义明显不适合 ASG 语境的（如：Flare - 拉平），可自创翻译。
3. 术语翻译一经选用，必须加入词汇表（`omegat/glossary/glossary.txt`）以供参考。

### 保留原文

1. 缩写（如 ESCU、TCCU、SMES、APP、INU）原则上保留，若出现在语音中则视具体情况而定。
2. 涉及引用游戏内界面内容，如控制面板按钮文本、菜单项目名称等（鼠标悬停气泡框除外），保留原文，以免玩家找不到所指内容。可酌情在原文后添加用括号包裹的译文。

### 标点符号使用

#### 原则

1. 中文句子视为一个中文环境，该环境内标点原则上都用中文/全角符号，这样可以与全角文字保持视觉的一致。
2. 如果整句为英文，视为一个英文环境，该环境内标点使用英文/半角符号。
3. 不同环境互相包裹的情况，环境分界处使用外部环境的标点，环境内部使用各自的标点。
4. 句号、问号、叹号、逗号、顿号、分号和冒号不得出现在一行之首。
5. 原文标点使用不规范的（如：句末缺少句号），翻译时应加以更正。

#### 引号

1. 因弯引号在游戏内显示效果较差，中文环境内应使用直角双引号（『』）和直角单引号（「」），双引号在外，单引号在内。禁止使用弯双引号（“”）和弯单引号（‘’）。

#### 空格

1. 原则上中英环境交界处若没有标点符号，则应留有空格。
2. 原则上数字和运算符两侧若没有标点符号，则均应留有空格。

#### 逗号

1. 技术名词的英文全称和英文缩写相邻时，视为同一英文环境，使用英文逗号分隔（例：deoxyribonucleic acid, DNA）。
2. 坐标、数组、参数等成分，整体视为英文环境，保留内部英文逗号（例：柱坐标（r, α, z）表示一个相对锚点的位置。）。

#### 顿号

1. 中文环境内，连续的英文成分呈并列关系时，视为各自独立的英文环境，用中文顿号分隔（例：TPV、DEC 和 APU 都接入设备汇流条。）。
2. 上述并列成分若被引号包裹，其间顿号可以省略。

#### 句号

1. 中文语句的结尾处应该用全角句号（。）。
2. 句子末尾用括号加注时，句号应在括号之外。
